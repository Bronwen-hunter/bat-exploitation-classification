#!/usr/bin/env python
# coding: utf-8

#### Script with functions used to preprocess web articles and social media posts ####

import re

URL_REGEX = r'http([^\.\s]+\.[^\.\s]*)+[^\.\s]{2,}'

def strip_username(text): # Removing usernames
    try:
        text = re.sub('@[a-zA-Z0-9_]+', ' ', text)
        return text
    except:
        print(f'Text "{text}" could not be processed (using strip_username)')
        return ''


def strip_newline(text): # Removing line separators
    text = re.sub('\n', '. ', text)
    return text


def norm_spaces(text): # Getting rid of extra spaces
    text = re.sub('\s+', ' ', text)
    text = text.strip()
    return text


def strip_url(text): # Removing URLs
    text = re.sub(URL_REGEX, ' ', text)
    return text


def strip_hashtags(text): # Removing hashtags
    text = re.sub('#', ' ', text)
    return text

def remove_emojis(text): # Removing emojis
    emoji_pattern = re.compile("["
                           u"\U0001F600-\U0001F64F"  # emoticons
                           u"\U0001F300-\U0001F5FF"  # symbols & pictographs
                           u"\U0001F680-\U0001F6FF"  # transport & map symbols
                           u"\U0001F1E0-\U0001F1FF"  # flags (iOS)
                           u"\U00002702-\U000027B0"
                           u"\U000024C2-\U0001F251"
                           "]+", flags=re.UNICODE)
    return emoji_pattern.sub(r'', text)


def preprocess(text: str):
    text = strip_username(text)
    text = strip_newline(text)
    text = strip_url(text)
    text = strip_hashtags(text)
    text = remove_emojis(text)
    text = norm_spaces(text)
    return text    
